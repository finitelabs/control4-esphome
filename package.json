{
  "config": {
    "distributions": "drivercentral oss",
    "drivers": "esphome esphome_light esphome_lock",
    "driver_names": {
      "esphome": "ESPHome",
      "esphome_light": "ESPHome Light",
      "esphome_lock": "ESPHome Lock"
    }
  },
  "scripts": {
    "init": "python -m venv .venv && . .venv/bin/activate && python -m pip install pip setuptools wheel protobuf types-protobuf black && env LDFLAGS=\"-L$(brew --prefix openssl)/lib\" CFLAGS=\"-I$(brew --prefix openssl)/include\" SWIG_FEATURES=\"-cpperraswarn -includeall -I$(brew --prefix openssl)/include\" pip install M2Crypto lxml && rm -rf dist/driverpackager && git clone git@github.com:snap-one/drivers-driverpackager.git dist/driverpackager",
    "fmt:lua": "stylua --indent-type Spaces --column-width 120 --line-endings Unix --indent-width 2 --quote-style AutoPreferDouble -g '*.lua' -v ./{drivers,src}",
    "fmt:py": ".venv/bin/black tools/*",
    "fmt:md": "prettier --prose-wrap always --write ./drivers/**/www/**/*.md",
    "fmt": "npm run fmt:lua && npm run fmt:md",
    "preprocess": "for build in $npm_package_config_distributions; do ./tools/preprocess --$build || exit 1; done",
    "docs:html": "for build in $npm_package_config_distributions; do for dir in $npm_package_config_drivers; do generate-md --layout github --input \"build/$build/drivers/$dir/www/documentation/index.md\" --output \"build/$build/drivers/$dir/www/documentation\"; done; done",
    "docs:pdf": "for build in $npm_package_config_distributions; do for dir in $npm_package_config_drivers; do driver_name_var=npm_package_config_driver_names_$dir; electron-pdf --marginsType 0 --input \"$(pwd)/build/$build/drivers/$dir/www/documentation/index.html\" --output \"dist/$build/${!driver_name_var} Documentation.pdf\"; done; done",
    "docs:readme": "rm -rf ./images && cp -r drivers/esphome/www/documentation/images . && pandoc build/oss/drivers/esphome/www/documentation/index.md -f gfm -t gfm --lua-filter=tools/pandoc-remove-style.lua -o README.md",
    "docs": "npm run docs:readme && npm run docs:html && npm run docs:pdf",
    "update-driver.xml:version": "for build in $npm_package_config_distributions; do for dir in $npm_package_config_drivers; do xmlstarlet edit --inplace --omit-decl --update '/devicedata/version' --value \"`date +'%Y%m%d'`\" ./build/$build/drivers/$dir/driver.xml; done; done",
    "update-driver.xml:modified": "for build in $npm_package_config_distributions; do for dir in $npm_package_config_drivers; do xmlstarlet edit --inplace --omit-decl --update '/devicedata/modified' --value \"`date +'%m/%d/%Y %I:%M %p'`\" ./build/$build/drivers/$dir/driver.xml; done; done",
    "update-driver.xml": "npm run update-driver.xml:version && npm run update-driver.xml:modified",
    "gen-lua-proto-schema": ".venv/bin/python3 tools/gen_lua_proto_schema src/esphome/proto-schema.lua https://raw.githubusercontent.com/esphome/esphome/refs/heads/dev/esphome/components/api/api.proto https://raw.githubusercontent.com/esphome/esphome/refs/heads/dev/esphome/components/api/api_options.proto",
    "package": "for build in $npm_package_config_distributions; do for dir in $npm_package_config_drivers; do export pwd=\"$(pwd)\" && cd \"build/$build/drivers/$dir\" && \"$pwd/.venv/bin/python3\" \"$pwd/dist/driverpackager/dp3/driverpackager.py\" . \"$pwd/dist/$build\" driver.c4zproj && cd \"$pwd\"; done; done",
    "zip": "for build in $npm_package_config_distributions; do cd \"dist/$build\" && zip $(basename \"$(realpath \"$(pwd)/../../\")\").zip *.{c4z,pdf} && cd ../../; done",
    "build": "npm run fmt && npm run preprocess && npm run update-driver.xml && npm run docs && npm run package && npm run zip",
    "clean:build": "for build in $npm_package_config_distributions; do rm -rfv \"dist/$build\";done && rm -rfv build",
    "clean": "npm run clean:build && rm -rfv dist node_modules .venv"
  },
  "dependencies": {
    "@johnnymorganz/stylua-bin": "^2.3.0",
    "electron-pdf": "^25.0.0",
    "markdown-styles": "^3.2.0",
    "prettier": "^3.6.2"
  }
}
